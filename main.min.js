async function getGoal(e){const t=await fetch(`missions/${e}.json`),o=await t.json(),c={lat:o.lat,lng:o.lng};return c}function getGeolocation(){return new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)})}function geolocationSuccess(e){const{latitude:t,longitude:o}=e.coords,c={lat:t,lng:o};return c}function geolocationError(e){console.log("Erreur de géolocalisation: ",e)}const places={amiens:["mairie","cathédrale","maison de jules verne"],moreuil:["tour du parc des sports","monument au morts","cimetière anglais"]},score=document.getElementById("score"),cityDiv=document.getElementById("cityDiv"),cityInput=document.getElementById("cityInput"),checkCity=document.getElementById("checkCity"),placeDiv=document.getElementById("placeDiv"),placeInput=document.getElementById("placeInput"),checkPlace=document.getElementById("checkPlace"),coosDiv=document.getElementById("coosDiv");score.innerText=localStorage.getItem("score")||0,checkCity.addEventListener("click",function(){if(cityInput.value){const e=document.getElementById("places");cityDiv.style.display="none",placeDiv.style.display="block";const t=Object.keys(places).find(e=>e===cityInput.value.toLowerCase());if(t){const o=places[t];o.forEach(t=>{const o=document.createElement("option");o.textContent=t,e.appendChild(o)})}}}),checkPlace.addEventListener("click",async function(){if(placeInput.value){const e=Object.keys(places),t=e.find(e=>e===cityInput.value.toLowerCase());if(t)try{const e=await getGeolocation(),o=geolocationSuccess(e),c=placeInput.value.toLowerCase().trim().replaceAll("é","e").replaceAll(" ","-").replaceAll("è","e"),n=await getGoal(`${t}/${c}`);if(Math.abs(o.lat-n.lat)<1&&Math.abs(o.lng-n.lng)<1&&!localStorage.getItem(`${t}/${c}`)){let e=parseInt(score.innerText,10);e++,score.innerText=e,localStorage.setItem(`${t}/${c}`,!0),localStorage.setItem("score",JSON.stringify(e))}coosDiv.innerText=`Position du lieu: Latitude: ${n.lat.toFixed(3)}, Longitude: ${n.lng.toFixed(3)}`}catch(e){geolocationError(e)}}});
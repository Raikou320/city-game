async function getGoal(e) {
    const t=await fetch(`missions/$ {
        e
    }
    .json`),c=await t.json(),n= {
        lat:c.lat,lng:c.lng
    };
    return n
}
function getGeolocation() {
    return new Promise((e,t)=> {
        navigator.geolocation.getCurrentPosition(e,t)
    })
}
function geolocationSuccess(e) {
    const {
        latitude:t,longitude:c
    }
    =e.coords,n= {
        lat:t,lng:c
    };
    return n
}
function geolocationError(e) {
    console.log("Erreur de géolocalisation: ",e)
}
const places= {
    amiens:["mairie","cathédrale","maison de jules verne"],moreuil:["tour du parc des sports","monument au morts","cimetière anglais"]
},
score=document.getElementById("score"),cityDiv=document.getElementById("cityDiv"),cityInput=document.getElementById("cityInput"),checkCity=document.getElementById("checkCity"),placeDiv=document.getElementById("placeDiv"),placeInput=document.getElementById("placeInput"),checkPlace=document.getElementById("checkPlace");
score.innerText=localStorage.getItem("score")||0, checkCity.addEventListener("click",function() {
    if(cityInput.value) {
        const e=document.getElementById("places");
        cityDiv.style.display="none",placeDiv.style.display="block";
        const t=Object.keys(places).find(e=>e===cityInput.value.toLowerCase());
        if(t) {
            const c=places[t];
            c.forEach(t=> {
                const c=document.createElement("option");
                c.textContent=t,e.appendChild(c)
            })
        }
    }
}),
checkPlace.addEventListener("click",async function() {
    if(placeInput.value) {
        const e=Object.keys(places),t=e.find(e=>e===cityInput.value.toLowerCase());
        if(t)try {
            const e=await getGeolocation(),c=geolocationSuccess(e),n=placeInput.value.toLowerCase().trim().replaceAll("é","e").replaceAll(" ","-").replaceAll("è","e"),o=await getGoal(`$ {
                cityInput.value
            }
            /$ {
                n
            }
            `);
            if(Math.abs(c.lat-o.lat)<1&&Math.abs(c.lng-o.lng)<1&&!localStorage.getItem(`$ {
                t
            }
            /$ {
                n
            }
            `)) {
                let e=parseInt(score.innerText,10);
                e++,score.innerText=e,localStorage.setItem(`${t}/$ {
                    n
                }
                `,!0),localStorage.setItem("score",JSON.stringify(e))
            }
        }
        catch(e) {
            geolocationError(e)
        }
    }
});